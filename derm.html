<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Project Sun Smart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:ital,wght@0,500;1,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --fade-time: 1s;
      --bg-dark: #000;
      --frost: rgba(255,255,255,0.15);
      --muted: rgba(255,255,255,0.8);
      --white: #fff;
      --green: #27ff9a;
      --red: #ff4d4d;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Barlow Condensed', sans-serif;
      background: var(--bg-dark);
      overflow: hidden;
      color: var(--white);
    }
    body {
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0;
      transition: opacity var(--fade-time) ease;
    }
    body.bg-loaded { opacity: 1; }

    .center {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 20px;
      text-align: center;
    }

    .headline {
      font-style: italic;
      font-weight: 700;
      font-size: clamp(36px, 8vw, 72px);
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
      margin-bottom: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .sub {
      font-weight: 500;
      color: var(--muted);
      font-size: clamp(16px, 3vw, 20px);
      margin-bottom: 30px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    form {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--frost);
      border-radius: 9999px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 4px 30px rgba(0,0,0,0.25);
      width: min(480px, 90vw);
      padding: 6px 8px 6px 16px;
      transition: transform 0.2s ease;
    }

    input[type="email"] {
      flex: 1;
      border: none;
      background: transparent;
      color: var(--white);
      font-size: 18px;
      font-weight: 500;
      outline: none;
      padding-right: 8px;
      min-width: 0;
    }
    input::placeholder { color: rgba(255,255,255,0.6); }

    button {
      border: none;
      border-radius: 50%;
      width: 46px;
      height: 46px;
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-shrink: 0;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      background: rgba(255,255,255,0.25);
      box-shadow: 0 0 10px rgba(255,255,255,0.3);
      position: relative;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255,255,255,0.6);
    }

    button svg {
      width: 22px;
      height: 22px;
      stroke: var(--white);
      stroke-width: 2.3;
      fill: none;
      transition: all 0.3s ease;
    }

    button.red {
      background: var(--red);
      box-shadow: 0 0 15px rgba(255,0,0,0.4);
    }
    button.green {
      background: var(--green);
      box-shadow: 0 0 15px rgba(39,255,154,0.4);
    }

    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 15px rgba(255,0,0,0.6); }
      50% { box-shadow: 0 0 30px rgba(255,0,0,0.9); }
    }
    button.red:hover {
      animation: pulseGlow 1.2s infinite ease-in-out;
      transform: scale(1.05);
    }

    .err {
      color: var(--white);
      font-size: 15px;
      min-height: 20px;
      margin-top: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-8px); }
      40%, 80% { transform: translateX(8px); }
    }
    .shake { animation: shake 0.4s ease; }

    #tallyWrap {
      position: fixed; inset: 0;
      opacity: 0; pointer-events: none;
      transition: opacity 0.8s ease;
      background: #000;
    }
    #tallyWrap.show { opacity: 1; pointer-events: auto; }
    #tallyFrame {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      border: 0;
    }

    @media (max-width: 420px) {
      .headline { font-size: 42px; }
    }
  </style>
</head>
<body>
  <div class="center" id="login">
    <div>
      <div class="headline">Project Sun Smart</div>
      <div class="sub">enter your school email to access Project Sun Smart files</div>
      <form id="gateForm" novalidate>
        <input id="email" type="email" placeholder="you@school.edu" required />
        <button id="submitBtn" type="submit" aria-label="Submit">
          <svg id="btnIcon" viewBox="0 0 24 24">
            <path d="M5 12h14M13 6l6 6-6 6"/>
          </svg>
        </button>
      </form>
      <div class="err" id="errMsg"></div>
    </div>
  </div>

  <div id="tallyWrap">
    <iframe id="tallyFrame" src="about:blank" allowfullscreen referrerpolicy="no-referrer"></iframe>
  </div>

  <script>
  (function(){
    const IMG_PATH = 'sky.jpg';
    const body = document.body;
    const gateForm = document.getElementById('gateForm');
    const emailEl = document.getElementById('email');
    const errMsg = document.getElementById('errMsg');
    const tallyWrap = document.getElementById('tallyWrap');
    const tallyFrame = document.getElementById('tallyFrame');
    const submitBtn = document.getElementById('submitBtn');
    const btnIcon = document.getElementById('btnIcon');

    let errorTriggered = false;

    // preload bg
    const img = new Image();
    img.src = IMG_PATH;
    img.onload = () => {
      body.style.backgroundImage = `url("${IMG_PATH}")`;
      body.classList.add('bg-loaded');
    };

    function isAllowedEmail(value){
      if (typeof value !== 'string') return false;
      const v = value.trim().toLowerCase();
      const looksEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
      return looksEmail && (v.endsWith('@llu.edu') || v.endsWith('@students.llu.edu'));
    }

    function openTally(){
      tallyFrame.src = 'https://tally.so/r/mKqKZV';
      tallyWrap.classList.add('show');
      document.getElementById('login').style.display = 'none';
    }

    function setButtonState(state){
      if(state === 'error'){
        submitBtn.classList.add('red');
        submitBtn.classList.remove('green');
        btnIcon.innerHTML = `
          <line x1="8" y1="8" x2="16" y2="16" stroke="white" stroke-width="2.5" stroke-linecap="round" />
          <line x1="16" y1="8" x2="8" y2="16" stroke="white" stroke-width="2.5" stroke-linecap="round" />
        `;
        submitBtn.onclick = () => {
          emailEl.value = '';
          setButtonState('default');
          errMsg.textContent = '';
          errorTriggered = false;
        };
      } else if(state === 'valid'){
        submitBtn.classList.add('green');
        submitBtn.classList.remove('red');
        btnIcon.innerHTML = '<path d="M5 12h14M13 6l6 6-6 6"/>';
        submitBtn.onclick = null;
      } else {
        submitBtn.classList.remove('green','red');
        btnIcon.innerHTML = '<path d="M5 12h14M13 6l6 6-6 6"/>';
        submitBtn.onclick = null;
      }
    }

    gateForm.addEventListener('submit', e=>{
      e.preventDefault();
      const email = emailEl.value;
      errMsg.textContent = '';
      if(!isAllowedEmail(email)){
        errMsg.textContent = 'Sorry, we were unable to verify your email address.';
        setButtonState('error');
        errorTriggered = true;
        gateForm.classList.remove('shake');
        void gateForm.offsetWidth;
        gateForm.classList.add('shake');
        return;
      }
      openTally();
    });

    gateForm.addEventListener('keydown', e=>{
      if(e.key==='Enter'){
        e.preventDefault();
        gateForm.requestSubmit();
      }
    });

    emailEl.addEventListener('input', ()=>{
      const val = emailEl.value.trim();
      if(val.length === 0){
        setButtonState('default');
        errMsg.textContent = '';
        return;
      }
      if(isAllowedEmail(val)){
        setButtonState('valid');
        errMsg.textContent = '';
        errorTriggered = false;
      } else if(errorTriggered){
        setButtonState('error');
      } else {
        setButtonState('default');
      }
    });
  })();
  </script>
</body>
</html>
